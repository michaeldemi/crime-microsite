<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vaughan Break-in Alerts | Free Service</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Leaflet CSS and JS for map functionality -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hero-glow {
            box-shadow: 0 0 80px 30px rgba(59, 130, 246, 0.25);
        }
        /* Remove the old map-placeholder styles and add new map styles */
        .leaflet-tile-pane img {
            filter: grayscale(1);
        }
        #vaughan-map {
            height: 400px;
            width: 100%;
            border-radius: 1rem;
            z-index: 1;
            position: relative;
        }
        /* Fix the map container height */
        .map-container {
            height: 400px;
            min-height: 400px;
            z-index: 1;
            position: relative;
        }
        /* Override Leaflet's default z-index for controls */
        .leaflet-control-container {
            z-index: 10 !important;
        }
        .leaflet-popup {
            z-index: 20 !important;
        }
        /* Custom pulse animation that only runs twice */
        @keyframes pulse-twice {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        .pulse-twice {
            animation: pulse-twice 2s ease-in-out 2;
        }
        /* Ensure proper grid layout */
        @media (min-width: 1024px) {
            .hero-grid {
                align-items: stretch;
            }
            .map-container {
                height: 100%;
                min-height: 500px;
            }
            #vaughan-map {
                height: 100%;
                min-height: 500px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-[60] border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                     <img src="images/window-guradian.svg" alt="Window Guardian" class="h-4">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section id="hero" class="py-16 sm:py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-slate-900 tracking-tight">
                    <span class="text-blue-600">542 Homes in Vaughan</span> Were Broken Into Last Year.
                    Get Notified When It Happens Next.
                </h1>
                <p class="mt-6 max-w-3xl mx-auto text-lg text-slate-600">
                    Our 100% free community service helps you stay informed and keep your family safe.
                </p>
                
                <!-- NEW: Recommendation 1 - Verified Data Badge -->
                <div class="mt-6 inline-flex items-center justify-center bg-slate-100 border border-slate-200 rounded-full px-4 py-2">
                    <i data-lucide="shield-check" class="w-5 h-5 text-blue-600 mr-2"></i>
                    <span class="text-sm font-semibold text-slate-700">Powered by Official & Verified YRP Data</span>
                </div>

                <!-- Add the missing map and form grid container -->
                <div class="mt-12 max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-stretch hero-grid">
                    <!-- Map as Centerpiece -->
                    <div class="w-full rounded-2xl border-4 border-slate-200 hero-glow map-container">
                        <div id="vaughan-map" class="w-full h-full rounded-lg"></div>
                    </div>

                    <!-- Signup Form -->
                    <div id="waitlist-form-container" class="bg-white p-8 rounded-2xl shadow-2xl border border-slate-200 text-left flex flex-col justify-center">
                         <!-- NEW: Recommendation 2 - Micro-Social Proof -->
                         <div class="flex items-center justify-center sm:justify-start mb-4">
                            <div class="flex items-center">
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current ml-1"></i>
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current ml-1"></i>
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current ml-1"></i>
                                <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current ml-1"></i>
                            </div>
                            <p class="ml-2 text-sm text-slate-600">Trusted by 120+ local residents</p>
                         </div>
                         <h2 class="text-2xl font-bold text-slate-900">Start Your Free Alerts Now</h2>
                         <p class="mt-2 text-slate-600">Enter your email to receive free, official break-in alerts for your neighbourhood.</p>
                         <form id="waitlist-form" class="mt-6 space-y-4">
                            <div>
                                <label for="email" class="sr-only">Email address</label>
                                <input type="email" name="email" id="email" class="w-full px-4 py-3 rounded-md border border-slate-300 placeholder-slate-400 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your email address" required>
                            </div>
                            <div class="flex items-start">
                                <div class="flex items-center h-5">
                                    <input id="casl-consent" name="casl-consent" type="checkbox" class="h-4 w-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500">
                                </div>
                                <div class="ml-3 text-sm">
                                    <label for="casl-consent" class="text-slate-500">Yes, send me occasional tips and exclusive offers from Window Guardian.</label>
                                </div>
                            </div>
                            <!-- NEW: Recommendation 3 - CTA Animation -->
                            <button type="submit" id="cta-button" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-300">
                                Get My Free Alerts
                            </button>
                         </form>
                         <!-- NEW: Recommendation 4 - Privacy Lock Icon -->
                         <p class="mt-4 text-xs text-slate-400 text-center flex items-center justify-center">
                            <i data-lucide="lock" class="w-3 h-3 mr-1.5"></i>
                            We respect your privacy. No spam, unsubscribe anytime.
                         </p>
                    </div>

                    <!-- Thank You Message (Hidden by default) -->
                    <div id="thank-you-message" class="hidden bg-white p-8 rounded-2xl shadow-2xl border border-green-300 text-left flex flex-col justify-center">
                        <div class="flex items-center justify-center w-16 h-16 rounded-full bg-green-100 mx-auto mb-4">
                            <i data-lucide="check" class="w-10 h-10 text-green-600"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-900 text-center">Success! Your Alerts are Active.</h2>
                        <p class="mt-2 text-slate-600 text-center">Your first security digest will arrive in your inbox within 24 hours.</p>
                        <div class="mt-6 p-4 bg-slate-100 rounded-lg">
                             <p class="font-semibold text-slate-800">In the meantime, don't leave your home unprotected.</p>
                             <p class="mt-1 text-slate-600">View our free Home Security Guide now to identify and fix your home's biggest vulnerabilities this weekend.</p>
                             <a href="#" class="mt-3 inline-block bg-slate-800 text-white font-semibold py-2 px-4 rounded-lg hover:bg-slate-900 transition-colors duration-300">
                                View The Guide
                             </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="py-16 sm:py-24">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Information is Your First Line of Defense</h2>
                    <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">Our free alert service is designed to be simple, timely, and effective.</p>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12">
                    <div class="text-center">
                         <div class="flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mx-auto">
                            <i data-lucide="mail-plus" class="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-slate-900">1. Subscribe in Seconds</h3>
                        <p class="mt-2 text-base text-slate-600">Enter your email to start receiving alerts. It takes 10 seconds and is 100% free.</p>
                    </div>
                    <div class="text-center">
                        <div class="flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mx-auto">
                            <i data-lucide="database" class="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-slate-900">2. We Monitor the Data</h3>
                        <p class="mt-2 text-base text-slate-600">Our system monitors the official YRP data feed daily for new reported incidents.</p>
                    </div>
                    <div class="text-center">
                        <div class="flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mx-auto">
                            <i data-lucide="siren" class="w-8 h-8 text-blue-600"></i>
                        </div>
                        <h3 class="mt-5 text-xl font-semibold text-slate-900">3. You Stay Informed</h3>
                        <p class="mt-2 text-base text-slate-600">Receive timely alerts to stay aware of what's happening in your community.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Social Proof Section -->
         <section class="py-16 sm:py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                     <h2 class="text-3xl font-bold tracking-tight text-slate-900 sm:text-4xl">Why Your Vaughan Neighbours Trust Us</h2>
                     <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600">We're a local business dedicated to our community's safety.</p>
                </div>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8">
                     <div class="bg-slate-50 p-8 rounded-2xl border border-slate-200">
                        <div class="flex items-center">
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                        </div>
                        <blockquote class="mt-4 text-lg text-slate-700">"After a break-in on our street, we knew we had to act. The installation took just a few hours, and now we have peace of mind without ugly bars on our windows."</blockquote>
                        <footer class="mt-4 font-semibold text-slate-900">Mark D., Vaughan</footer>
                     </div>
                     <div class="bg-slate-50 p-8 rounded-2xl border border-slate-200">
                         <div class="flex items-center">
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                           <i data-lucide="star" class="w-5 h-5 text-yellow-400 fill-current ml-1"></i>
                        </div>
                        <blockquote class="mt-4 text-lg text-slate-700">"The free alert service is fantastic. We get the weekly digest and it's a real eye-opener. Knowing what's happening nearby is the first step to staying safe."</blockquote>
                        <footer class="mt-4 font-semibold text-slate-900">Sarah K., Richmond Hill</footer>
                     </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="py-16 sm:py-24">
             <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl font-bold text-center text-slate-900">Frequently Asked Questions</h2>
                 <div class="mt-10 space-y-6">
                     <div class="bg-white p-6 rounded-lg border border-slate-200">
                         <h3 class="font-semibold text-lg text-slate-900">Is this service really free?</h3>
                         <p class="mt-2 text-slate-600">Yes, 100%. We offer this as a free community service to help our neighbours stay safe. There are no hidden costs or obligations.</p>
                     </div>
                     <div class="bg-white p-6 rounded-lg border border-slate-200">
                         <h3 class="font-semibold text-lg text-slate-900">Where does the data come from?</h3>
                         <p class="mt-2 text-slate-600">All our information comes directly from a daily API feed provided by York Regional Police, ensuring the data is official, timely, and verified.</p>
                     </div>
                      <div class="bg-white p-6 rounded-lg border border-slate-200">
                         <h3 class="font-semibold text-lg text-slate-900">How often will I get alerts?</h3>
                         <p class="mt-2 text-slate-600">You can choose to receive a daily summary email or a weekly digest. We provide options to ensure you get the information you want without overwhelming your inbox.</p>
                     </div>
                      <div class="bg-white p-6 rounded-lg border border-slate-200">
                         <h3 class="font-semibold text-lg text-slate-900">Will you sell or spam my email?</h3>
                         <p class="mt-2 text-slate-600">Absolutely not. We respect your privacy. You will only receive the alerts you signed up for. If you opt-in for promotional content, you can unsubscribe with a single click at any time.</p>
                     </div>
                 </div>
             </div>
        </section>

        <!-- Final CTA Section -->
        <section class="py-16 sm:py-24 bg-blue-600">
            <div class="max-w-3xl mx-auto text-center px-4 sm:px-6 lg:px-8">
                 <h2 class="text-3xl font-bold text-white">Get Your Free Alerts Today</h2>
                 <p class="mt-4 text-lg text-blue-100">Sign up now and get the information you need to keep your community safe. It's fast, free, and powered by official police data.</p>
                 <div class="mt-8">
                     <!-- A simple CTA button that smoothly scrolls back to the form -->
                     <a href="#hero" class="bg-white text-blue-600 font-semibold py-3 px-8 rounded-lg hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-blue-600 focus:ring-white transition-colors duration-300">
                         Get My Free Alerts
                     </a>
                 </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <p class="text-base text-slate-400">&copy; 2025 Window Guardian. All rights reserved.</p>
                <p class="mt-2 text-sm text-slate-500">A Community Safety Initiative.</p>
            </div>
        </div>
    </footer>

        <!-- Sticky Footer CTA for Mobile -->
    <div class="sticky bottom-0 z-40 bg-white/90 backdrop-blur-sm border-t border-slate-200 p-4 md:hidden">
        <a href="#hero" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-300 flex items-center justify-center text-center">
            <i data-lucide="mail-plus" class="w-5 h-5 mr-2"></i>
            Get My Free Alerts
        </a>
    </div>


    <script>
        lucide.createIcons();

        // Map initialization function - UPDATED to calculate dynamic count
        async function initializeVaughanMap() {
            const mapElement = document.getElementById('vaughan-map');
            if (!mapElement) return;

            // Initialize map centered on Vaughan with higher zoom
            const map = L.map('vaughan-map').setView([43.8361, -79.4985], 12);
            
            // Add grayscale tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Load Vaughan FSA data
            const vaughanFSAs = ['L4H', 'L4J', 'L4K', 'L4L', 'L6A'];
            let allIncidents = [];

            for (const fsa of vaughanFSAs) {
                try {
                    const response = await fetch(`./data/${fsa}.json`, { cache: 'no-store' });
                    if (response.ok) {
                        const data = await response.json();
                        allIncidents = allIncidents.concat(data);
                    }
                } catch (err) {
                    console.warn(`No data for FSA ${fsa}:`, err);
                }
            }

            // Calculate dynamic count using same logic as main-simplified.js
            const getLast12MonthsCutoff = () => {
                const d = new Date();
                d.setFullYear(d.getFullYear() - 1);
                d.setHours(0, 0, 0, 0);
                return d;
            };

            const parseDate = (v) => {
                if (!v) return null;
                const d = new Date(String(v).replace(' ', 'T'));
                return isNaN(d) ? null : d;
            };

            const cutoff12 = getLast12MonthsCutoff();
            let count12 = 0;
            const markers = [];

            allIncidents.forEach((incident, index) => {
                const lat = incident.lat || incident.latitude || incident.Latitude;
                const lng = incident.lng || incident.lon || incident.longitude || incident.Longitude;
                
                // Count incidents from last 12 months using same logic
                const dt = parseDate(incident.occurrence_date);
                if (dt && dt >= cutoff12) {
                    count12++;
                }
                
                if (lat && lng && !isNaN(lat) && !isNaN(lng)) {
                    const latNum = parseFloat(lat);
                    const lngNum = parseFloat(lng);
                    
                    const marker = L.marker([latNum, lngNum]).addTo(map);
                    
                    const offence = incident.offence || incident.offense || incident.type || incident.crime_type || 'Break & Enter';
                    const date = incident.occurrence_date || incident.date || incident.Date || 'Unknown';
                    const location = incident.location || incident.Location || incident.address || 'Vaughan';
                    
                    const popupContent = `
                        <div class="text-sm">
                            <strong>${offence}</strong><br>
                            Date: ${date}<br>
                            Location: ${location}
                        </div>
                    `;
                    
                    marker.bindPopup(popupContent);
                    markers.push(marker);
                }
            });

            // Update headline with dynamic count (same approach as main-simplified.js)
            const headline = document.querySelector('h1 span.text-blue-600');
            if (headline) {
                const homeText = count12 === 1 ? 'Home' : 'Homes';
                headline.textContent = `${count12} ${homeText} in Vaughan`;
            }

            // Fit map to show all markers with constraints
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.02), {
                    maxZoom: 14,  // Don't zoom out past level 14
                    minZoom: 11   // Don't zoom in past level 11
                });
            } else {
                // Fallback zoom if no markers
                map.setZoom(13);
            }

            console.log(`Loaded ${markers.length} incidents on map, ${count12} in last 12 months`);
        }

        // Initialize map when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeVaughanMap();
            
            // Add pulse animation to CTA button after a short delay
            setTimeout(() => {
                const ctaButton = document.getElementById('cta-button');
                if (ctaButton) {
                    ctaButton.classList.add('pulse-twice');
                }
            }, 1000); // Wait 1 second after page load
        });

        // --- Form Submission Logic for Active Service ---
        const formContainer = document.getElementById('waitlist-form-container');
        const thankYouMessage = document.getElementById('thank-you-message');
        const waitlistForm = document.getElementById('waitlist-form');

        waitlistForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent actual form submission

            // Here you would typically send the data to your server or email list provider
            // to ACTUALLY subscribe the user.
            const email = document.getElementById('email').value;
            console.log(`Email submitted for active service: ${email}`);

            // Hide the form and show the thank you message
            if (formContainer && thankYouMessage) {
                formContainer.classList.add('hidden');
                thankYouMessage.classList.remove('hidden');
            }
        });

        // --- Smooth scroll for the final CTA ---
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>

</body>
</html>

